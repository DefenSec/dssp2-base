;; -*- mode: CIL; fill-column: 79; indent-tabs-mode: nil; -*-
;; SPDX-License-Identifier: Unlicense

;; sys
;;     abi_sysctl
;;     cpu_sysfs
;;     cpu_online_sysfs
;;     cpuinfo_proc
;;     crypto_sysctl
;;     debug_sysctl
;;     dev_sysctl
;;     fs_sysctl
;;     generic_sysctl
;;     invalid
;;         obj_all_macro_template
;;     iomem_proc
;;     irq_sysctl
;;     isid
;;         stub
;;     kallsyms_proc
;;     kcore_proc
;;     kernel_sysctl
;;     kmsg_proc
;;     latency_stats_proc
;;     load_kernel_init_module
;;     load_kernel_module
;;     manage_files_except
;;     mdstat_proc
;;     meminfo_proc
;;     memory_sysfs
;;     mountpoint
;;         obj_all_macro_template
;;     mtrr_proc
;;     net_proc
;;     net_sysctl
;;     net_unix_sysctl
;;     node_sysfs
;;     node_online_sysfs
;;     proc_file
;;         obj_all_macro_template
;;         obj_stub
;;         obj_template
;;     security_sysctl
;;     sysctl_file
;;         obj_all_macro_template
;;         obj_stub
;;         obj_template
;;     sysfs_file
;;         obj_all_macro_template
;;         obj_stub
;;         obj_template
;;     sysrq_proc
;;     timer_proc
;;     unlabeled
;;     user_sysctl
;;     usermodehelper_sysctl
;;     var_log
;;     vm_sysctl
;;     vm_overcommit_sysctl

;;
;; Policy
;;

(sid file)
(sid kernel)
(sid sysctl)
(sid unlabeled)

(block sys

       ;;
       ;; Contexts
       ;;

       (sidcontext kernel (sys.id sys.role isid (systemlow systemlow)))

       ;;
       ;; Macros
       ;;

       (macro dontaudit_link_keyring ((type ARG1))
              (dontaudit ARG1 isid link_key_perms))

       (macro audit_client ((type ARG1))
              (allow ARG1 self (capability (audit_write)))
              (allow ARG1 self r_netlink_audit_socket_perms)
              (allow ARG1 self (netlink_audit_socket (nlmsg_relay))))

       (macro audit_set_loginuid ((type ARG1))
              (allow ARG1 self (capability (audit_control)))
              (allow ARG1 self r_netlink_audit_socket_perms)
              (allow ARG1 self (netlink_audit_socket (nlmsg_relay))))

       (macro audit_set_params ((type ARG1))
              (allow ARG1 self (capability (audit_control audit_write)))
              (allow ARG1 self create_netlink_audit_socket_perms)
              (allow ARG1 self (netlink_audit_socket (nlmsg_relay))))

       (macro audit_set_tty_audit ((type ARG1))
              (allow ARG1 self r_netlink_audit_socket_perms)
              (allow ARG1 self (netlink_audit_socket (nlmsg_tty_audit))))

       (macro change_ring_buffer_level ((type ARG1))
              (allow ARG1 self (capability2 (syslog)))
              (allow ARG1 isid (system (syslog_console))))

       (macro dump_kernel_subj_type ((type ARG1))
              (typeattributeset dump_kernel_subj_type_attribute ARG1))

       (macro get_sysvipc_info ((type ARG1))
              (allow ARG1 isid (system (ipc_info))))

       (macro link_keyring ((type ARG1))
              (allow ARG1 isid link_key_perms))

       (macro load_kernel_module_subj_type ((type ARG1))
              (typeattributeset load_kernel_module_subj_type_attribute ARG1))

       (macro mounton_invalid_dir_subj_type ((type ARG1))
              (typeattributeset mounton_invalid_dir_subj_type_attribute ARG1))

       (macro obj_type ((type ARG1))
              (typeattributeset obj_type_attribute ARG1))

       (macro read_kernel_msg_subj_type ((type ARG1))
              (typeattributeset read_kernel_msg_subj_type_attribute ARG1))

       (macro read_keyring ((type ARG1))
              (allow ARG1 isid read_key_perms))

       (macro read_ring_buffer ((type ARG1))
              (allow ARG1 self (capability2 (syslog)))
              (allow ARG1 isid (system (syslog_read))))

       (macro read_state ((type ARG1))
              (allow ARG1 isid (process_state (read))))

       (macro recv_invalid_packets_subj_type ((type ARG1))
              (typeattributeset recv_invalid_packets_subj_type_attribute
                                ARG1))

       (macro recv_and_send_invalid_packets_subj_type ((type ARG1))
              (call recv_invalid_packets_subj_type (ARG1))
              (call send_invalid_packets_subj_type (ARG1)))

       (macro recv_invalid_peers_subj_type ((type ARG1))
              (typeattributeset recv_invalid_peers_subj_type_attribute ARG1))

       (macro request_load_kernel_module ((type ARG1))
              (allow ARG1 isid (system (module_request))))

       (macro role ((role ARG1))
              (roleattributeset role_attribute ARG1))

       (macro roleallow_role ((role ARG1))
              (roleattributeset roleallow_role_attribute ARG1))

       (macro read_netlink_audit_sockets ((type ARG1))
              (allow ARG1 isid r_netlink_audit_socket_perms))

       (macro read_inherited_netlink_audit_sockets ((type ARG1))
              (allow ARG1 isid (netlink_audit_socket (read))))

       (macro rw_unix_dgram_sockets ((type ARG1))
              (allow ARG1 isid rw_unix_dgram_socket_perms))

       (macro rw_unix_stream_sockets ((type ARG1))
              (allow ARG1 isid rw_unix_stream_socket_perms))

       (macro send_invalid_packets_subj_type ((type ARG1))
              (typeattributeset send_invalid_packets_subj_type_attribute
                                ARG1))

       (macro setkeycreate ((type ARG1))
              (allow ARG1 isid (process (setkeycreate))))

       (macro setpgid ((type ARG1))
              (allow ARG1 isid (process (setpgid))))

       (macro setsched ((type ARG1))
              (allow ARG1 isid (process (setsched))))

       (macro share ((type ARG1))
              (allow ARG1 isid (process (share))))

       (macro sigchld ((type ARG1))
              (allow ARG1 isid (process (sigchld))))

       (macro transition ((type ARG1))
              (allow ARG1 isid (process (transition))))

       (macro unconfined_subj_type ((type ARG1))
              (typeattributeset unconfined_subj_type_attribute ARG1))

       (macro unix_dgram_socket_sendto ((type ARG1))
              (allow ARG1 self create_unix_dgram_socket_perms)
              (allow ARG1 isid (unix_dgram_socket (sendto))))

       (macro unix_stream_socket_connectto ((type ARG1))
              (allow ARG1 self create_unix_stream_socket_perms)
              (allow ARG1 isid (unix_stream_socket (connectto))))

       (macro use_fd ((type ARG1))
              (allow ARG1 isid (fd (use))))

       (macro userrole_user ((user ARG1))
              (userrole ARG1 role))

       (macro write_security_subj_type ((type ARG1))
              (typeattributeset write_security_subj_type_attribute ARG1))

       (macro write_usermodehelper_subj_type ((type ARG1))
              (typeattributeset write_usermodehelper_subj_type_attribute ARG1))

       ;;
       ;; Policy
       ;;

       (boolean load_kernel_init_module true)
       (boolean load_kernel_module true)
       (boolean manage_files_except true)
       (boolean mounton_invalid_dir true)
       (boolean recv_and_send_invalid_packets true)
       (boolean recv_invalid_peers true)

       (roleattribute role_attribute)
       (roleattribute roleallow_role_attribute)

       (typeattribute dump_kernel_subj_type_attribute)
       (typeattribute
        not_dump_kernel_subj_type_or_unconfined_subj_type_attribute)

       (typeattribute load_kernel_module_subj_type_attribute)
       (typeattribute not_load_kernel_module_subj_type_attribute)

       (typeattribute mounton_invalid_dir_subj_type_attribute)
       (typeattribute not_mounton_invalid_dir_subj_type_attribute)

       (typeattribute obj_type_attribute)

       (typeattribute
        not_read_kernel_msg_subj_type_or_unconfined_subj_type_attribute)
       (typeattribute read_kernel_msg_subj_type_attribute)

       (typeattribute not_recv_invalid_packets_subj_type_attribute)
       (typeattribute recv_invalid_packets_subj_type_attribute)

       (typeattribute not_send_invalid_packets_subj_type_attribute)
       (typeattribute send_invalid_packets_subj_type_attribute)

       (typeattribute recv_invalid_peers_subj_type_attribute)
       (typeattribute not_recv_invalid_peers_subj_type_attribute)

       (typeattribute unconfined_subj_type_attribute)

       (typeattribute
        not_unconfined_subj_type_or_write_security_subj_type_attribute)
       (typeattribute write_security_subj_type_attribute)

       (typeattribute
        not_unconfined_subj_type_or_write_usermodehelper_subj_type_attribute)
       (typeattribute write_usermodehelper_subj_type_attribute)

       (user id)
       (role role)

       (userlevel id systemlow)

       (userrange id (systemlow systemhigh))

       (userrole id role)

       (blockinherit isid.stub)

       (roletype role isid)

       (call subj.common_subj.subj_type (isid))

       (roleallow role roleallow_role_attribute)

       (roletype role_attribute obj_type_attribute)

       (call role (role))

       (call ibac_sys_id (id))

       (call rbacsep_exemption_role (role))
       (call rbac_sys_role (role))

       (dontaudit isid self (capability (dac_override)))
       (allow isid self (capability
                         (sys_tty_config sys_admin sys_nice net_admin
                                         net_bind_service dac_read_search)))
       (allow isid self (capability2 (block_suspend)))
       (allow isid self (process (setsched)))
       (allow isid self (unix_dgram_socket (sendto)))
       (allow isid self create_unix_stream_socket_perms)

       (call change_ring_buffer_level (isid))
       (call request_load_kernel_module (isid))
       (call sys.send_invalid_packets_subj_type (isid))

       (call recv_invalid_packets_subj_type (isid))
       (call recv_invalid_peers_subj_type (isid))

       (call dev.clock.devtmpfs_obj_type_transition (isid))
       (call dev.cuse.devtmpfs_obj_type_transition (isid))
       (call dev.devtty.tmpfs_obj_type_transition (isid))
       (call dev.event.devtmpfs_obj_type_transition (isid))
       (call dev.kvm.devtmpfs_obj_type_transition (isid))
       (call dev.dev_file.manage_chr_files (isid))
       (call dev.mei_misc.devtmpfs_obj_type_transition (isid))

       (call dev.modem.devtmpfs_obj_type_transition (isid))
       (call dev.mouse.devtmpfs_obj_type_transition (isid))
       (call dev.null.tmpfs_obj_type_transition (isid))
       (call dev.random.tmpfs_obj_type_transition (isid))
       (call dev.sound.devtmpfs_obj_type_transition (isid))
       (call dev.tpm.devtmpfs_obj_type_transition (isid))
       (call dev.urandom.tmpfs_obj_type_transition (isid))
       (call dev.usb.devtmpfs_obj_type_transition (isid))
       (call dev.v4l.devtmpfs_obj_type_transition (isid))
       (call dev.watchdog.devtmpfs_obj_type_transition (isid))
       (call dev.wireless.devtmpfs_obj_type_transition (isid))
       (call dev.zero.tmpfs_obj_type_transition (isid))

       (call files.generic_data.read (isid))

       (call fs.tracefs.search (isid))
       (call fs.devtmpfs.manage_blk_files (isid))
       (call fs.devtmpfs.manage_chr_files (isid))
       (call fs.devtmpfs.manage_dirs (isid))
       (call fs.devtmpfs.manage_lnk_files (isid))
       (call fs.rootfs.manage_dirs (isid))
       (call fs.rootfs.manage_files (isid))
       (call fs.rootfs.mounton_dirs (isid))
       (call fs.sysfs.read (isid))
       (call fs.tmpfs.search (isid))
       (call fs.xattr.getattr_fs (isid))

       (call net.generic_if.egress (isid))
       (call net.generic_node.sendto (isid))
       (call net.generic_packet.packet_send (isid))

       (call sec.compute_create_context (isid))

       (call term.generic_serial.devtmpfs_obj_type_transition (isid))
       (call term.generic_serial.manage_chr_files (isid))

       (optional sys_optional_bluetooth
                 (call bluetooth.daemon.rw_sockets (isid)))

       (optional sys_optional_bootchart
                 (call bootchart.auto_subj_type_transition (isid)))

       (optional sys_optional_cgroups_agent
                 (call cgroups_agent.auto_subj_type_transition (isid)))

       (optional sys_optional_dracut_initramfs
                 (call dracut_initramfs.runtime.list (isid)))

       (optional sys_optional_fsutils
                 (call fsutils.use_fd (isid)))

       (optional sys_optional_gssproxy
                 (call gssproxy.unix_stream_socket_connectto (isid)))

       (optional sys_optional_importd
                 (call importd.use_fd (isid)))

       (optional sys_optional_keyutils
                 (call keyutils.request_key.auto_subj_type_transition (isid)))

       (optional sys_optional_kmod
                 (call kmod.auto_subj_type_transition (isid)))

       (optional sys_optional_lorax
                 (call lorax.lmc.use_fd (isid)))

       (optional sys_optional_misc
                 (call misc.font.client_subj_type (isid)))

       (optional sys_optional_mkosi
                 (call mkosi.use_fd (isid)))

       (optional sys_optional_mount
                 (call mount.rw_inherited_image_files (isid))
                 (call mount.use_fd (isid))

                 (booleanif mount.mount_any_file
                            (true
                             (call files.rw_inherited_except (isid)))))

       (optional sys_optional_nfs
                 (call nfs.client.auto_subj_type_transition (isid))
                 (call nfs.rpcnfsd.read_tcp_sockets (isid)))

       (optional sys_optional_nspawn
                 (call nspawn.use_fd (isid)))

       (optional sys_optional_plymouth
                 (call plymouth.config.read (isid))
                 (call plymouth.runtime.manage (isid))
                 (call plymouth.var_lib.manage (isid)))

       (optional sys_optional_portable
                 (call portable.daemon.use_fd (isid)))

       (optional sys_optional_rpcbind
                 (call rpcbind.daemon.unix_stream_socket_connectto (isid)))

       (optional sys_optional_sd_coredump
                 (call sd_coredump.auto_subj_type_transition (isid)))

       (optional sys_optional_stor
                 (call stor.fixed_disk.devtmpfs_obj_type_transition (isid))
                 (call stor.stor_file.manage (isid))
                 (call stor.removable.devtmpfs_obj_type_transition (isid))
                 (call stor.scsi_generic.devtmpfs_obj_type_transition (isid)))

       (optional sys_optional_systemd
                 (call subj.dyntransition_subj_type (isid))
                 (call systemd.getattr_files (isid))
                 (call systemd.system.dynamic_subj_type_transition (isid))
                 (call systemd.system.read_state (isid))
                 (call systemd.system.signal (isid))
                 (call systemd.system.use_fd (isid)))

       (optional sys_optional_udev
                 (call udev.client_subj_type (isid)))

       (optional sys_optional_udisks
                 (call udisks.client.use_fd (isid)))

       (typeattributeset
        not_dump_kernel_subj_type_or_unconfined_subj_type_attribute
        (not (dump_kernel_subj_type_attribute unconfined_subj_type_attribute)))

       (typeattributeset not_load_kernel_module_subj_type_attribute
                         (not load_kernel_module_subj_type_attribute))

       (neverallow not_load_kernel_module_subj_type_attribute self
                   (capability (sys_module)))

       (typeattributeset not_mounton_invalid_dir_subj_type_attribute
                         (not mounton_invalid_dir_subj_type_attribute))

       (typeattributeset
        not_read_kernel_msg_subj_type_or_unconfined_subj_type_attribute
        (not (read_kernel_msg_subj_type_attribute
              unconfined_subj_type_attribute)))

       (typeattributeset not_recv_invalid_packets_subj_type_attribute
                         (not (recv_invalid_packets_subj_type_attribute)))

       (typeattributeset not_send_invalid_packets_subj_type_attribute
                         (not (send_invalid_packets_subj_type_attribute)))

       (typeattributeset not_recv_invalid_peers_subj_type_attribute
                         (not (recv_invalid_peers_subj_type_attribute)))

       (allow unconfined_subj_type_attribute isid system_except_module_load)

       (call load_kernel_module_subj_type (unconfined_subj_type_attribute))

       (call mounton_invalid_dir_subj_type (unconfined_subj_type_attribute))

       (call var_log.generic_var_log_obj_type_transition
             (unconfined_subj_type_attribute))

       (typeattributeset
        not_unconfined_subj_type_or_write_security_subj_type_attribute
        (not (unconfined_subj_type_attribute
              write_security_subj_type_attribute)))

       (typeattributeset
        not_unconfined_subj_type_or_write_usermodehelper_subj_type_attribute
        (not (unconfined_subj_type_attribute
              write_usermodehelper_subj_type_attribute)))

       (block abi_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/abi" sysctl_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template))

       (block cpu_sysfs

              ;;
              ;; Contexts
              ;;

              (genfscon "sysfs" "/devices/system/cpu" sysfs_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysfs_file.obj_template))

       (block cpu_online_sysfs

              ;;
              ;; Contexts
              ;;

              (genfscon "sysfs" "/devices/system/cpu/online"
                        sysfs_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 sysfs_file append_file_perms)
                     (call cpu_sysfs.search (ARG1)))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 sysfs_file (file (getattr)))
                     (call cpu_sysfs.search (ARG1)))

              (macro read_files ((type ARG1))
                     (allow ARG1 sysfs_file read_file_perms)
                     (call cpu_sysfs.search (ARG1)))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 sysfs_file relabel_file_perms)
                     (call cpu_sysfs.search (ARG1)))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 sysfs_file relabelfrom_file_perms)
                     (call cpu_sysfs.search (ARG1)))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 sysfs_file relabelto_file_perms)
                     (call cpu_sysfs.search (ARG1)))

              (macro rw_files ((type ARG1))
                     (allow ARG1 sysfs_file rw_file_perms)
                     (call cpu_sysfs.search (ARG1)))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 sysfs_file (file (setattr)))
                     (call cpu_sysfs.search (ARG1)))

              (macro write_files ((type ARG1))
                     (allow ARG1 sysfs_file write_file_perms)
                     (call cpu_sysfs.search (ARG1)))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysfs_file.obj_stub))

       (block cpuinfo_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/cpuinfo" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub))

       (block crypto_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/crypto" sysctl_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template))

       (block debug_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/debug" sysctl_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template))

       (block dev_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/dev" sysctl_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template))

       (block fs_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/fs" sysctl_file_context)

              ;;
              ;; Macros
              ;;

              (macro mounton_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dir (getattr mounton))))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template)

              (allow unconfined_subj_type_attribute sysctl_file
                     (dir (getattr mounton))))

       (block generic_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys" isid_context)

              (sidcontext sysctl isid_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 isid append_file_perms)
                     (call search (ARG1)))

              (macro getattr ((type ARG1))
                     (call getattr_dirs (ARG1))
                     (call getattr_files (ARG1))
                     (call getattr_lnk_files (ARG1)))

              (macro getattr_dirs ((type ARG1))
                     (allow ARG1 isid (dirs (getattr))))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 isid (files (getattr))))

              (macro getattr_lnk_files ((type ARG1))
                     (allow ARG1 isid (lnk_files (getattr))))

              (macro list ((type ARG1))
                     (allow ARG1 isid list_dir_perms))

              (macro mounton_dirs ((type ARG1))
                     (allow ARG1 isid (dir (getattr mounton))))

              (macro read ((type ARG1))
                     (call list (ARG1))
                     (call read_files (ARG1))
                     (call read_lnk_files (ARG1)))

              (macro read_files ((type ARG1))
                     (allow ARG1 isid (files (read))))

              (macro read_lnk_files ((type ARG1))
                     (allow ARG1 isid (lnk_files (read))))

              (macro relabel ((type ARG1))
                     (call relabel_dirs (ARG1))
                     (call relabel_files (ARG1))
                     (call relabel_lnk_files (ARG1)))

              (macro relabel_dirs ((type ARG1))
                     (allow ARG1 isid (dirs (relabel))))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 isid (files (relabel))))

              (macro relabel_lnk_files ((type ARG1))
                     (allow ARG1 isid (lnk_files (relabel))))

              (macro relabelfrom ((type ARG1))
                     (call relabelfrom_dirs (ARG1))
                     (call relabelfrom_files (ARG1))
                     (call relabelfrom_lnk_files (ARG1)))

              (macro relabelfrom_dirs ((type ARG1))
                     (allow ARG1 isid (dirs (relabelfrom))))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 isid (files (relabelfrom))))

              (macro relabelfrom_lnk_files ((type ARG1))
                     (allow ARG1 isid (lnk_files (relabelfrom))))

              (macro relabelto ((type ARG1))
                     (call relabelto_dirs (ARG1))
                     (call relabelto_files (ARG1))
                     (call relabelto_lnk_files (ARG1)))

              (macro relabelto_dirs ((type ARG1))
                     (allow ARG1 isid (dirs (relabelto))))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 isid (files (relabelto))))

              (macro relabelto_lnk_files ((type ARG1))
                     (allow ARG1 isid (lnk_files (relabelto))))

              (macro rw ((type ARG1))
                     (call rw_dirs (ARG1))
                     (call rw_files (ARG1))
                     (call rw_lnk_files (ARG1)))

              (macro rw_dirs ((type ARG1))
                     (allow ARG1 isid (dirs (rw))))

              (macro rw_files ((type ARG1))
                     (allow ARG1 isid (files (rw))))

              (macro rw_lnk_files ((type ARG1))
                     (allow ARG1 isid (lnk_files (rw))))

              (macro search ((type ARG1))
                     (allow ARG1 isid search_dir_perms))

              (macro setattr ((type ARG1))
                     (call setattr_dirs (ARG1))
                     (call setattr_files (ARG1))
                     (call setattr_lnk_files (ARG1)))

              (macro setattr_dirs ((type ARG1))
                     (allow ARG1 isid (dirs (setattr))))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 isid (files (setattr))))

              (macro setattr_lnk_files ((type ARG1))
                     (allow ARG1 isid (lnk_files (setattr))))

              (macro write ((type ARG1))
                     (call write_dirs (ARG1))
                     (call write_files (ARG1))
                     (call write_lnk_files (ARG1)))

              (macro write_dirs ((type ARG1))
                     (allow ARG1 isid (dirs (write))))

              (macro write_files ((type ARG1))
                     (allow ARG1 isid (files (write))))

              (macro write_lnk_files ((type ARG1))
                     (allow ARG1 isid (lnk_files (write))))

              ;;
              ;; Policy
              ;;

              (blockinherit isid.stub)

              (call sysctl_file.obj_type (isid))

              (allow unconfined_subj_type_attribute isid
                     (dir (getattr mounton))))

       (block invalid

              ;;
              ;; Contexts
              ;;

              (sidcontext unlabeled isid_context)

              ;;
              ;; Macros
              ;;

              (blockinherit obj_all_macro_template)

              (macro dccp_recvfrom ((type ARG1))
                     (allow ARG1 isid (dccp_socket (recvfrom))))

              (macro forward_in ((type ARG1))
                     (allow ARG1 isid (packet (forward_in))))

              (macro forward_out ((type ARG1))
                     (allow ARG1 isid (packet (forward_out))))

              (macro icmp_recvfrom ((type ARG1))
                     (allow ARG1 isid (icmp_socket (recvfrom))))

              (macro infiniband_endport_manage_subnet ((type ARG1))
                     (allow ARG1 isid (infiniband_endport (manage_subnet))))

              (macro infiniband_pkey_access ((type ARG1))
                     (allow ARG1 isid (infiniband_pkey (access))))

              (macro ipsec_association_recvfrom_sendto ((type ARG1))
                     (allow ARG1 isid (association (recvfrom sendto))))

              (macro mounton_dirs ((type ARG1))
                     (allow ARG1 isid (dir (getattr mounton))))

              (macro packet_recv ((type ARG1))
                     (allow ARG1 isid (packet (recv))))

              (macro packet_send ((type ARG1))
                     (allow ARG1 isid (packet (send))))

              (macro peer_recv ((type ARG1))
                     (allow ARG1 isid (peer (recv))))

              (macro rawip_recvfrom ((type ARG1))
                     (allow ARG1 isid (rawip_socket (recvfrom))))

              (macro read_state ((type ARG1))
                     (allow ARG1 isid (process_state (read))))

              (macro packet_relabelto ((type ARG1))
                     (allow ARG1 isid (packet (relabelto))))

              (macro sctp_association ((type ARG1))
                     (allow ARG1 isid (sctp_socket (association))))

              (macro sctp_recvfrom ((type ARG1))
                     (allow ARG1 isid (sctp_socket (recvfrom))))

              (macro sigkill ((type ARG1))
                     (allow ARG1 isid (process (sigkill))))

              (macro signal ((type ARG1))
                     (allow ARG1 isid (process (signal))))

              (macro signull ((type ARG1))
                     (allow ARG1 isid (process (signull))))

              (macro sigstop ((type ARG1))
                     (allow ARG1 isid (process (sigstop))))

              (macro tcp_recvfrom ((type ARG1))
                     (allow ARG1 isid (tcp_socket (recvfrom))))

              (macro udp_recvfrom ((type ARG1))
                     (allow ARG1 isid (udp_socket (recvfrom))))

              ;;
              ;; Policy
              ;;

              (blockinherit isid.stub)

              (roletype role isid)

              (allow isid self (process (sigchld)))

              (allow isid self rw_file_perms)
              (allow isid self list_dir_perms)
              (allow isid self read_lnk_file_perms)

              (allow isid self (filesystem (associate)))

              (call fs.nfs.associate (isid))
              (call fs.proc.search (isid))
              (call fs.tmpfs.associate (isid))
              (call fs.xattr.associate (isid))

              (booleanif recv_and_send_invalid_packets
                         (true
                          (call forward_in (isid))
                          (call forward_out (isid))))

              (booleanif recv_invalid_peers
                         (true
                          (call net.generic_node.sendto (isid))
                          (call net.if.ingress (isid))
                          (call net.node.recvfrom (isid))))

              (optional invalid_optional_systemd
                        (call systemd.system.sigchld (isid)))

              (neverallow not_mounton_invalid_dir_subj_type_attribute isid
                          (dir (mounton)))

              (neverallow not_recv_invalid_packets_subj_type_attribute isid
                          (packet (recv)))

              (neverallow not_send_invalid_packets_subj_type_attribute isid
                          (packet (send)))

              (neverallow not_recv_invalid_peers_subj_type_attribute isid
                          (peer (recv)))

              (allow unconfined_subj_type_attribute isid
                     blk_file_except_execmod_map_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     chr_file_except_execmod_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     dir_except_execmod_map_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     fifo_file_except_execmod_map_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     file_except_entrypoint_execmod_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     (filesystem (associate getattr mount quotaget quotamod
                                            remount relabelfrom relabelto
                                            unmount)))
              (allow unconfined_subj_type_attribute isid
                     lnk_file_except_execmod_map_and_mounton)
              (allow unconfined_subj_type_attribute isid signal_perms)
              (allow unconfined_subj_type_attribute isid
                     sock_file_except_execmod_map_and_mounton)

              ;;
              ;; Templates
              ;;

              (block obj_all_macro_template

                     ;;
                     ;; Macros
                     ;;

                     (macro add_entries ((type ARG1))
                            (allow ARG1 isid add_entry_dir_perms))

                     (macro append_blk_files ((type ARG1))
                            (allow ARG1 isid append_blk_file_perms)
                            (call search (ARG1)))

                     (macro append_chr_files ((type ARG1))
                            (allow ARG1 isid append_chr_file_perms)
                            (call search (ARG1)))

                     (macro append_fifo_files ((type ARG1))
                            (allow ARG1 isid append_fifo_file_perms)
                            (call search (ARG1)))

                     (macro append_files ((type ARG1))
                            (allow ARG1 isid append_file_perms)
                            (call search (ARG1)))

                     (macro associate ((type ARG1))
                            (allow ARG1 isid (filesystem (associate))))

                     (macro create ((type ARG1))
                            (allow ARG1 isid (all_files (create))))

                     (macro create_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (create))))

                     (macro create_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (create))))

                     (macro create_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (create))))

                     (macro create_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (create))))

                     (macro create_files ((type ARG1))
                            (allow ARG1 isid (files (create))))

                     (macro create_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (create))))

                     (macro create_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (create))))

                     (macro del_entries ((type ARG1))
                            (allow ARG1 isid del_entry_dir_perms))

                     (macro delete ((type ARG1))
                            (allow ARG1 isid (all_files (delete))))

                     (macro delete_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (delete))))

                     (macro delete_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (delete))))

                     (macro delete_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (delete))))

                     (macro delete_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (delete))))

                     (macro delete_files ((type ARG1))
                            (allow ARG1 isid (files (delete))))

                     (macro delete_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (delete))))

                     (macro delete_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (delete))))

                     (macro execute ((type ARG1))
                            (allow ARG1 isid exec_file_perms)
                            (call search (ARG1)))

                     (macro getattr ((type ARG1))
                            (allow ARG1 isid (all_files (getattr))))

                     (macro getattr_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (getattr))))

                     (macro getattr_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (getattr))))

                     (macro getattr_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (getattr))))

                     (macro getattr_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (getattr))))

                     (macro getattr_files ((type ARG1))
                            (allow ARG1 isid (files (getattr))))

                     (macro getattr_fs ((type ARG1))
                            (allow ARG1 isid (filesystem (getattr))))

                     (macro getattr_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (getattr))))

                     (macro getattr_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (getattr))))

                     (macro list ((type ARG1))
                            (allow ARG1 isid list_dir_perms))

                     (macro manage ((type ARG1))
                            (allow ARG1 isid (all_files (manage))))

                     (macro manage_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (manage))))

                     (macro manage_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (manage))))

                     (macro manage_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (manage))))

                     (macro manage_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (manage))))

                     (macro manage_files ((type ARG1))
                            (allow ARG1 isid (files (manage))))

                     (macro manage_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (manage))))

                     (macro manage_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (manage))))

                     (macro map_files ((type ARG1))
                            (allow ARG1 isid (files (map))))

                     (macro mapr_files ((type ARG1))
                            (allow ARG1 isid (files (mapr))))

                     (macro maprw_files ((type ARG1))
                            (allow ARG1 isid (files (maprw))))

                     (macro maprx ((type ARG1))
                            (allow ARG1 isid (files (maprx))))

                     (macro mount ((type ARG1))
                            (allow ARG1 isid (filesystem (mount))))

                     (macro quotaget ((type ARG1))
                            (allow ARG1 isid (filesystem (quotaget))))

                     (macro quotamod ((type ARG1))
                            (allow ARG1 isid (filesystem (quotamod))))

                     (macro read ((type ARG1))
                            (allow ARG1 isid (all_files (read))))

                     (macro read_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (read))))

                     (macro read_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (read))))

                     (macro read_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (read))))

                     (macro read_files ((type ARG1))
                            (allow ARG1 isid (files (read))))

                     (macro read_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (read))))

                     (macro read_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (read))))

                     (macro relabel ((type ARG1))
                            (allow ARG1 isid (all_files (relabel))))

                     (macro relabel_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (relabel))))

                     (macro relabel_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (relabel))))

                     (macro relabel_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (relabel))))

                     (macro relabel_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (relabel))))

                     (macro relabel_files ((type ARG1))
                            (allow ARG1 isid (files (relabel))))

                     (macro relabel_fs ((type ARG1))
                            (allow ARG1 isid (filesystem (getattr relabelfrom
                                                                  relabelto))))
                     (macro relabel_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (relabel))))

                     (macro relabel_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (relabel))))

                     (macro relabelfrom ((type ARG1))
                            (allow ARG1 isid (all_files (relabelfrom))))

                     (macro relabelfrom_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (relabelfrom))))

                     (macro relabelfrom_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (relabelfrom))))

                     (macro relabelfrom_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (relabelfrom))))

                     (macro relabelfrom_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (relabelfrom))))

                     (macro relabelfrom_files ((type ARG1))
                            (allow ARG1 isid (files (relabelfrom))))

                     (macro relabelfrom_fs ((type ARG1))
                            (allow ARG1 isid (filesystem (getattr
                                                          relabelfrom))))

                     (macro relabelfrom_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (relabelfrom))))

                     (macro relabelfrom_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (relabelfrom))))

                     (macro relabelto ((type ARG1))
                            (allow ARG1 isid (all_files (relabelto))))

                     (macro relabelto_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (relabelto))))

                     (macro relabelto_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (relabelto))))

                     (macro relabelto_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (relabelto))))

                     (macro relabelto_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (relabelto))))

                     (macro relabelto_files ((type ARG1))
                            (allow ARG1 isid (files (relabelto))))

                     (macro relabelto_fs ((type ARG1))
                            (allow ARG1 isid (filesystem (getattr relabelto))))

                     (macro relabelto_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (relabelto))))

                     (macro relabelto_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (relabelto))))

                     (macro remount ((type ARG1))
                            (allow ARG1 isid (filesystem (remount))))

                     (macro rename ((type ARG1))
                            (allow ARG1 isid (all_files (rename))))

                     (macro rename_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (rename))))

                     (macro rename_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (rename))))

                     (macro rename_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (rename))))

                     (macro rename_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (rename))))

                     (macro rename_files ((type ARG1))
                            (allow ARG1 isid (files (rename))))

                     (macro rename_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (rename))))

                     (macro rename_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (rename))))

                     (macro rw ((type ARG1))
                            (allow ARG1 isid (all_files (rw))))

                     (macro rw_blk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (rw))))

                     (macro rw_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (rw))))

                     (macro rw_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (rw))))

                     (macro rw_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (rw))))

                     (macro rw_files ((type ARG1))
                            (allow ARG1 isid (files (rw))))

                     (macro rw_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (rw))))

                     (macro rw_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (rw))))

                     (macro search ((type ARG1))
                            (allow ARG1 isid search_dir_perms))

                     (macro setattr ((type ARG1))
                            (allow ARG1 isid (all_files (setattr))))

                     (macro setattr_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (setattr))))

                     (macro setattr_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (setattr))))

                     (macro setattr_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (setattr))))

                     (macro setattr_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (setattr))))

                     (macro setattr_files ((type ARG1))
                            (allow ARG1 isid (files (setattr))))

                     (macro setattr_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (setattr))))

                     (macro setattr_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (setattr))))

                     (macro unmount ((type ARG1))
                            (allow ARG1 isid (filesystem (unmount))))

                     (macro write ((type ARG1))
                            (allow ARG1 isid (all_files (write))))

                     (macro write_blk_files ((type ARG1))
                            (allow ARG1 isid (blk_files (write))))

                     (macro write_chr_files ((type ARG1))
                            (allow ARG1 isid (chr_files (write))))

                     (macro write_dirs ((type ARG1))
                            (allow ARG1 isid (dirs (write))))

                     (macro write_fifo_files ((type ARG1))
                            (allow ARG1 isid (fifo_files (write))))

                     (macro write_files ((type ARG1))
                            (allow ARG1 isid (files (write))))

                     (macro write_lnk_files ((type ARG1))
                            (allow ARG1 isid (lnk_files (write))))

                     (macro write_sock_files ((type ARG1))
                            (allow ARG1 isid (sock_files (write))))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_all_macro_template)))

       (block iomem_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/iomem" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub))

       (block irq_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/irq" sysctl_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 sysctl_file append_file_perms)
                     (call search (ARG1)))

              (macro getattr ((type ARG1))
                     (call getattr_dirs (ARG1))
                     (call getattr_files (ARG1))
                     (call getattr_lnk_files (ARG1)))

              (macro getattr_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (getattr))))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (getattr))))

              (macro getattr_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (getattr))))

              (macro list ((type ARG1))
                     (allow ARG1 sysctl_file list_dir_perms))

              (macro mounton_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dir (getattr mounton))))

              (macro read ((type ARG1))
                     (call list (ARG1))
                     (call read_files (ARG1))
                     (call read_lnk_files (ARG1)))

              (macro read_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (read))))

              (macro read_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (read))))

              (macro relabel ((type ARG1))
                     (call relabel_dirs (ARG1))
                     (call relabel_files (ARG1))
                     (call relabel_lnk_files (ARG1)))

              (macro relabel_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabel))))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabel))))

              (macro relabel_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabel))))

              (macro relabelfrom ((type ARG1))
                     (call relabelfrom_dirs (ARG1))
                     (call relabelfrom_files (ARG1))
                     (call relabelfrom_lnk_files (ARG1)))

              (macro relabelfrom_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabelfrom))))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabelfrom))))

              (macro relabelfrom_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabelfrom))))

              (macro relabelto ((type ARG1))
                     (call relabelto_dirs (ARG1))
                     (call relabelto_files (ARG1))
                     (call relabelto_lnk_files (ARG1)))

              (macro relabelto_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabelto))))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabelto))))

              (macro relabelto_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabelto))))

              (macro rw ((type ARG1))
                     (call rw_dirs (ARG1))
                     (call rw_files (ARG1))
                     (call rw_lnk_files (ARG1)))

              (macro rw_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (rw))))

              (macro rw_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (rw))))

              (macro rw_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (rw))))

              (macro search ((type ARG1))
                     (allow ARG1 sysctl_file search_dir_perms))

              (macro setattr ((type ARG1))
                     (call setattr_dirs (ARG1))
                     (call setattr_files (ARG1))
                     (call setattr_lnk_files (ARG1)))

              (macro setattr_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (setattr))))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (setattr))))

              (macro setattr_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (setattr))))

              (macro write ((type ARG1))
                     (call write_dirs (ARG1))
                     (call write_files (ARG1))
                     (call write_lnk_files (ARG1)))

              (macro write_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (write))))

              (macro write_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (write))))

              (macro write_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (write))))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_stub)

              (allow unconfined_subj_type_attribute sysctl_file
                     (dir (getattr mounton))))

       (block isid

              ;;
              ;; Templates
              ;;

              (block stub

                     ;;
                     ;; Contexts
                     ;;

                     (context isid_context (sys.id sys.role isid (systemlow
                                                                  systemlow)))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract stub)

                     (type isid)))

       (block kallsyms_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/kallsyms" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro mounton_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr mounton))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub)

              (allow unconfined_subj_type_attribute proc_file
                     (file (getattr mounton))))

       (block kcore_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/kcore" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms)
                     (call dump_kernel_subj_type (ARG1)))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro mounton_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr mounton))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms)
                     (call dump_kernel_subj_type (ARG1)))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms)
                     (call dump_kernel_subj_type (ARG1)))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms)
                     (call dump_kernel_subj_type (ARG1)))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub)

              (neverallow
               not_dump_kernel_subj_type_or_unconfined_subj_type_attribute
               proc_file (file (append read write)))

              (allow unconfined_subj_type_attribute proc_file
                     (file (getattr mounton))))

       (block kernel_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/kernel" sysctl_file_context)

              ;;
              ;; Macros
              ;;

              (macro mounton_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dir (getattr mounton))))

              (macro mounton_files ((type ARG1))
                     (allow ARG1 sysctl_file (file (getattr mounton))))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template))

       (block kmsg_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/kmsg" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms)
                     (call read_kernel_msg_subj_type (ARG1)))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro mounton_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr mounton))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms)
                     (call read_kernel_msg_subj_type (ARG1)))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms)
                     (call read_kernel_msg_subj_type (ARG1)))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms)
                     (call read_kernel_msg_subj_type (ARG1)))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub)

              (neverallow
               not_read_kernel_msg_subj_type_or_unconfined_subj_type_attribute
               proc_file (file (append read write)))

              (allow unconfined_subj_type_attribute proc_file
                     (file (getattr mounton))))

       (block latency_stats_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/latency_stats" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro mounton_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr mounton))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub)

              (allow unconfined_subj_type_attribute proc_file
                     (file (getattr mounton))))

       (block load_kernel_init_module

              ;;
              ;; Contexts
              ;;

              (genfscon "selinuxfs" "/booleans/sys.load_kernel_init_module"
                        bool_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sec.bool_file.obj_template)

              (booleanif
               (and load_kernel_init_module load_kernel_module)
               (true
                (allow load_kernel_module_subj_type_attribute self
                       (system (module_load))))))

       (block load_kernel_module

              ;;
              ;; Contexts
              ;;

              (genfscon "selinuxfs" "/booleans/sys.load_kernel_module"
                        bool_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sec.bool_file.obj_template)

              (booleanif load_kernel_module
                         (true
                          (allow load_kernel_module_subj_type_attribute self
                                 (capability (sys_module sys_nice)))
                          (allow load_kernel_module_subj_type_attribute
                                 sys.isid (process (setsched))))))

       (block manage_files_except

              ;;
              ;; Contexts
              ;;

              (genfscon "selinuxfs" "/booleans/sys.manage_files_except"
                        bool_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sec.bool_file.obj_template)

              (booleanif manage_files_except
                         (true
                          (call files.manage_except (isid)))))

       (block mdstat_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/mdstat" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub))

       (block meminfo_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/meminfo" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub))

       (block memory_sysfs

              ;;
              ;; Contexts
              ;;

              (genfscon "sysfs" "/devices/system/memory" sysfs_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysfs_file.obj_template))

       (block mounton_invalid_dir

              ;;
              ;; Contexts
              ;;

              (genfscon "selinuxfs" "/booleans/sys.mounton_invalid_dir"
                        bool_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sec.bool_file.obj_template)

              (booleanif mounton_invalid_dir
                         (true
                          (allow mounton_invalid_dir_subj_type_attribute
                                 sys.invalid.isid (dir (getattr mounton))))))

       (block mountpoint

              ;;
              ;; Macros
              ;;

              (blockinherit obj_all_macro_template)

              ;;
              ;; Policy
              ;;

              (typeattribute obj_type_attribute)

              (allow unconfined_subj_type_attribute obj_type_attribute
                     (dir (getattr mounton)))

              ;;
              ;; Templates
              ;;

              (block obj_all_macro_template

                     ;;
                     ;; Macros
                     ;;

                     (macro dontaudit_audit_access_dirs ((type ARG1))
                            (dontaudit ARG1 obj_type_attribute
                                       (dir (audit_access))))

                     (macro dontaudit_list ((type ARG1))
                            (dontaudit ARG1 obj_type_attribute list_dir_perms))

                     (macro dontaudit_setattr_dirs ((type ARG1))
                            (dontaudit ARG1 obj_type_attribute (dir
                                                                (setattr))))

                     (macro add_entries ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   add_entry_dir_perms))

                     (macro audit_write_access_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dir (getattr
                                                                 write))))

                     (macro create_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (create))))

                     (macro del_entries ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   del_entry_dir_perms))

                     (macro delete_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (delete))))

                     (macro getattr_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (getattr))))

                     (macro list ((type ARG1))
                            (allow ARG1 obj_type_attribute list_dir_perms))

                     (macro manage_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (manage))))

                     (macro mounton_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dir (getattr
                                                                 mounton))))

                     (macro obj_type ((type ARG1))
                            (typeattributeset obj_type_attribute ARG1))

                     (macro obj_type_transition
                            ((type ARG1)(type ARG2)(class ARG3)(name ARG4))
                            (typetransition ARG1 obj_type_attribute ARG3 ARG4
                                            ARG2)
                            (call rw_dirs (ARG1)))

                     (macro relabel_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (relabel))))

                     (macro relabelfrom_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs
                                                            (relabelfrom))))

                     (macro relabelto_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (relabelto))))

                     (macro rename_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (rename))))

                     (macro rw_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (rw))))

                     (macro search ((type ARG1))
                            (allow ARG1 obj_type_attribute search_dir_perms))

                     (macro setattr_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (setattr))))

                     (macro write_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dirs (write))))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_all_macro_template)))

       (block mtrr_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/mtrr" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro mounton_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr mounton))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub)

              (allow unconfined_subj_type_attribute proc_file
                     (file (getattr mounton))))

       (block net_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/net" proc_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_template))

       (block net_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/net" sysctl_file_context)

              ;;
              ;; Macros
              ;;

              (macro mounton_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dir (getattr mounton))))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template))

       (block net_unix_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/net/unix" sysctl_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 sysctl_file append_file_perms)
                     (call search (ARG1)))

              (macro getattr ((type ARG1))
                     (call getattr_dirs (ARG1))
                     (call getattr_files (ARG1))
                     (call getattr_lnk_files (ARG1)))

              (macro getattr_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (getattr)))
                     (call net_sysctl.search (ARG1)))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (getattr)))
                     (call net_sysctl.search (ARG1)))

              (macro getattr_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (getattr)))
                     (call net_sysctl.search (ARG1)))

              (macro list ((type ARG1))
                     (allow ARG1 sysctl_file list_dir_perms)
                     (call net_sysctl.search (ARG1)))

              (macro read ((type ARG1))
                     (call list (ARG1))
                     (call read_files (ARG1))
                     (call read_lnk_files (ARG1)))

              (macro read_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (read)))
                     (call net_sysctl.search (ARG1)))

              (macro read_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (read)))
                     (call net_sysctl.search (ARG1)))

              (macro relabel ((type ARG1))
                     (call relabel_dirs (ARG1))
                     (call relabel_files (ARG1))
                     (call relabel_lnk_files (ARG1)))

              (macro relabel_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabel)))
                     (call net_sysctl.search (ARG1)))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabel)))
                     (call net_sysctl.search (ARG1)))

              (macro relabel_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabel)))
                     (call net_sysctl.search (ARG1)))

              (macro relabelfrom ((type ARG1))
                     (call relabelfrom_dirs (ARG1))
                     (call relabelfrom_files (ARG1))
                     (call relabelfrom_lnk_files (ARG1)))

              (macro relabelfrom_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabelfrom)))
                     (call net_sysctl.search (ARG1)))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabelfrom)))
                     (call net_sysctl.search (ARG1)))

              (macro relabelfrom_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabelfrom)))
                     (call net_sysctl.search (ARG1)))

              (macro relabelto ((type ARG1))
                     (call relabelto_dirs (ARG1))
                     (call relabelto_files (ARG1))
                     (call relabelto_lnk_files (ARG1)))

              (macro relabelto_dirs ((type ARG1))
                      (allow ARG1 sysctl_file (dirs (relabelto)))
                     (call net_sysctl.search (ARG1)))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabelto)))
                     (call net_sysctl.search (ARG1)))

              (macro relabelto_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabelto)))
                     (call net_sysctl.search (ARG1)))

              (macro rw ((type ARG1))
                     (call rw_dirs (ARG1))
                     (call rw_files (ARG1))
                     (call rw_lnk_files (ARG1)))

              (macro rw_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (rw)))
                     (call net_sysctl.search (ARG1)))

              (macro rw_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (rw)))
                     (call net_sysctl.search (ARG1)))

              (macro rw_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (rw)))
                     (call net_sysctl.search (ARG1)))

              (macro search ((type ARG1))
                     (allow ARG1 sysctl_file search_dir_perms)
                     (call net_sysctl.search (ARG1)))

              (macro setattr ((type ARG1))
                     (call setattr_dirs (ARG1))
                     (call setattr_files (ARG1))
                     (call setattr_lnk_files (ARG1)))

              (macro setattr_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (setattr)))
                     (call net_sysctl.search (ARG1)))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (setattr)))
                     (call net_sysctl.search (ARG1)))

              (macro setattr_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (setattr)))
                     (call net_sysctl.search (ARG1)))

              (macro write ((type ARG1))
                     (call write_dirs (ARG1))
                     (call write_files (ARG1))
                     (call write_lnk_files (ARG1)))

              (macro write_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (write)))
                     (call net_sysctl.search (ARG1)))

              (macro write_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (write)))
                     (call net_sysctl.search (ARG1)))

              (macro write_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (write)))
                     (call net_sysctl.search (ARG1)))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_stub))

       (block node_sysfs

              ;;
              ;; Contexts
              ;;

              (genfscon "sysfs" "/devices/system/node" sysfs_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysfs_file.obj_template))

       (block node_online_sysfs

              ;;
              ;; Contexts
              ;;

              (genfscon "sysfs" "/devices/system/node/online"
                        sysfs_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 sysfs_file append_file_perms)
                     (call node_sysfs.search (ARG1)))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 sysfs_file (file (getattr)))
                     (call node_sysfs.search (ARG1)))

              (macro read_files ((type ARG1))
                     (allow ARG1 sysfs_file read_file_perms)
                     (call node_sysfs.search (ARG1)))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 sysfs_file relabel_file_perms)
                     (call node_sysfs.search (ARG1)))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 sysfs_file relabelfrom_file_perms)
                     (call node_sysfs.search (ARG1)))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 sysfs_file relabelto_file_perms)
                     (call node_sysfs.search (ARG1)))

              (macro rw_files ((type ARG1))
                     (allow ARG1 sysfs_file rw_file_perms)
                     (call node_sysfs.search (ARG1)))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 sysfs_file (file (setattr)))
                     (call node_sysfs.search (ARG1)))

              (macro write_files ((type ARG1))
                     (allow ARG1 sysfs_file write_file_perms)
                     (call node_sysfs.search (ARG1)))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysfs_file.obj_stub))

       (block proc_file

              ;;
              ;; Macros
              ;;

              (blockinherit obj_all_macro_template)

              ;;
              ;; Policy
              ;;

              (typeattribute obj_type_attribute)

              (call sys.obj_type (obj_type_attribute))

              (allow unconfined_subj_type_attribute obj_type_attribute
                     list_dir_perms)
              (allow unconfined_subj_type_attribute obj_type_attribute
                     read_lnk_file_perms)
              (allow unconfined_subj_type_attribute obj_type_attribute
                     rw_file_perms)

              ;;
              ;; Templates
              ;;

              (block obj_all_macro_template

                     ;;
                     ;; Macros
                     ;;

                     (macro dontaudit_read_files ((type ARG1))
                            (dontaudit ARG1 obj_type_attribute
                                       read_file_perms))

                     (macro append_files ((type ARG1))
                            (allow ARG1 obj_type_attribute append_file_perms)
                            (call sys.dump_kernel_subj_type (ARG1))
                            (call sys.read_kernel_msg_subj_type (ARG1)))

                     (macro getattr ((type ARG1))
                            (call getattr_dirs (ARG1))
                            (call getattr_files (ARG1))
                            (call getattr_lnk_files (ARG1)))

                     (macro getattr_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dir (getattr))))

                     (macro getattr_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (file (getattr))))

                     (macro getattr_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (lnk_file
                                                            (getattr))))

                     (macro list ((type ARG1))
                            (allow ARG1 obj_type_attribute list_dir_perms))

                     (macro obj_type ((type ARG1))
                            (typeattributeset obj_type_attribute ARG1))

                     (macro read ((type ARG1))
                            (call list (ARG1))
                            (call read_files (ARG1))
                            (call read_lnk_files (ARG1)))

                     (macro read_files ((type ARG1))
                            (allow ARG1 obj_type_attribute read_file_perms)
                            (call sys.dump_kernel_subj_type (ARG1))
                            (call sys.read_kernel_msg_subj_type (ARG1)))

                     (macro read_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   read_lnk_file_perms))

                     (macro relabel ((type ARG1))
                            (call relabel_dirs (ARG1))
                            (call relabel_files (ARG1))
                            (call relabel_lnk_files (ARG1)))

                     (macro relabel_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute relabel_dir_perms))

                     (macro relabel_files ((type ARG1))
                            (allow ARG1 obj_type_attribute relabel_file_perms))

                     (macro relabel_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabel_lnk_file_perms))

                     (macro relabelfrom ((type ARG1))
                            (call relabelfrom_dirs (ARG1))
                            (call relabelfrom_files (ARG1))
                            (call relabelfrom_lnk_files (ARG1)))

                     (macro relabelfrom_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_dir_perms))

                     (macro relabelfrom_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_file_perms))

                     (macro relabelfrom_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_lnk_file_perms))

                     (macro relabelto ((type ARG1))
                            (call relabelto_dirs (ARG1))
                            (call relabelto_files (ARG1))
                            (call relabelto_lnk_files (ARG1)))

                     (macro relabelto_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelto_dir_perms))

                     (macro relabelto_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelto_file_perms))

                     (macro relabelto_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelto_lnk_file_perms))

                     (macro rw ((type ARG1))
                            (call rw_dirs (ARG1))
                            (call rw_files (ARG1))
                            (call rw_lnk_files (ARG1)))

                     (macro rw_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_dir_perms))

                     (macro rw_files ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_file_perms)
                            (call sys.dump_kernel_subj_type (ARG1))
                            (call sys.read_kernel_msg_subj_type (ARG1)))

                     (macro rw_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_lnk_file_perms))

                     (macro search ((type ARG1))
                            (allow ARG1 obj_type_attribute search_dir_perms))

                     (macro setattr ((type ARG1))
                            (call setattr_dirs (ARG1))
                            (call setattr_files (ARG1))
                            (call setattr_lnk_files (ARG1)))

                     (macro setattr_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dir (setattr))))

                     (macro setattr_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (file (setattr))))

                     (macro setattr_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (lnk_file
                                                            (setattr))))

                     (macro write ((type ARG1))
                            (call write_dirs (ARG1))
                            (call write_files (ARG1))
                            (call write_lnk_files (ARG1)))

                     (macro write_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute write_dir_perms))

                     (macro write_files ((type ARG1))
                            (allow ARG1 obj_type_attribute write_file_perms))

                     (macro write_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   write_lnk_file_perms))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_all_macro_template))

              (block obj_stub

                     ;;
                     ;; Contexts
                     ;;

                     (context proc_file_context (sys.id sys.role proc_file
                                                        (systemlow systemlow)))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_stub)

                     (type proc_file)
                     (call sys.proc_file.obj_type (proc_file)))

              (block obj_template

                     ;;
                     ;; Macros
                     ;;

                     (macro append_files ((type ARG1))
                            (allow ARG1 proc_file append_file_perms))

                     (macro getattr ((type ARG1))
                            (call getattr_dirs (ARG1))
                            (call getattr_files (ARG1))
                            (call getattr_lnk_files (ARG1)))

                     (macro getattr_dirs ((type ARG1))
                            (allow ARG1 proc_file (dir (getattr))))

                     (macro getattr_files ((type ARG1))
                            (allow ARG1 proc_file (file (getattr))))

                     (macro getattr_lnk_files ((type ARG1))
                            (allow ARG1 proc_file (lnk_file (getattr))))

                     (macro list ((type ARG1))
                            (allow ARG1 proc_file list_dir_perms))

                     (macro read ((type ARG1))
                            (call list (ARG1))
                            (call read_files (ARG1))
                            (call read_lnk_files (ARG1)))

                     (macro read_files ((type ARG1))
                            (allow ARG1 proc_file read_file_perms))

                     (macro read_lnk_files ((type ARG1))
                            (allow ARG1 proc_file read_lnk_file_perms))

                     (macro relabel ((type ARG1))
                            (call relabel_dirs (ARG1))
                            (call relabel_files (ARG1))
                            (call relabel_lnk_files (ARG1)))

                     (macro relabel_dirs ((type ARG1))
                            (allow ARG1 proc_file relabel_dir_perms))

                     (macro relabel_files ((type ARG1))
                            (allow ARG1 proc_file relabel_file_perms))

                     (macro relabel_lnk_files ((type ARG1))
                            (allow ARG1 proc_file relabel_lnk_file_perms))

                     (macro relabelfrom ((type ARG1))
                            (call relabelfrom_dirs (ARG1))
                            (call relabelfrom_files (ARG1))
                            (call relabelfrom_lnk_files (ARG1)))

                     (macro relabelfrom_dirs ((type ARG1))
                            (allow ARG1 proc_file relabelfrom_dir_perms))

                     (macro relabelfrom_files ((type ARG1))
                            (allow ARG1 proc_file relabelfrom_file_perms))

                     (macro relabelfrom_lnk_files ((type ARG1))
                            (allow ARG1 proc_file relabelfrom_lnk_file_perms))

                     (macro relabelto ((type ARG1))
                            (call relabelto_dirs (ARG1))
                            (call relabelto_files (ARG1))
                            (call relabelto_lnk_files (ARG1)))

                     (macro relabelto_dirs ((type ARG1))
                            (allow ARG1 proc_file relabelto_dir_perms))

                     (macro relabelto_files ((type ARG1))
                            (allow ARG1 proc_file relabelto_file_perms))

                     (macro relabelto_lnk_files ((type ARG1))
                            (allow ARG1 proc_file relabelto_lnk_file_perms))

                     (macro rw ((type ARG1))
                            (call rw_dirs (ARG1))
                            (call rw_files (ARG1))
                            (call rw_lnk_files (ARG1)))

                     (macro rw_dirs ((type ARG1))
                            (allow ARG1 proc_file rw_dir_perms))

                     (macro rw_files ((type ARG1))
                            (allow ARG1 proc_file rw_file_perms))

                     (macro rw_lnk_files ((type ARG1))
                            (allow ARG1 proc_file rw_lnk_file_perms))

                     (macro search ((type ARG1))
                            (allow ARG1 proc_file search_dir_perms))

                     (macro setattr ((type ARG1))
                            (call setattr_dirs (ARG1))
                            (call setattr_files (ARG1))
                            (call setattr_lnk_files (ARG1)))

                     (macro setattr_dirs ((type ARG1))
                            (allow ARG1 proc_file (dir (setattr))))

                     (macro setattr_files ((type ARG1))
                            (allow ARG1 proc_file (file (setattr))))

                     (macro setattr_lnk_files ((type ARG1))
                            (allow ARG1 proc_file (lnk_file (setattr))))

                     (macro write ((type ARG1))
                            (call write_dirs (ARG1))
                            (call write_files (ARG1))
                            (call write_lnk_files (ARG1)))

                     (macro write_dirs ((type ARG1))
                            (allow ARG1 proc_file write_dir_perms))

                     (macro write_files ((type ARG1))
                            (allow ARG1 proc_file write_file_perms))

                     (macro write_lnk_files ((type ARG1))
                            (allow ARG1 proc_file write_lnk_file_perms))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_template)

                     (blockinherit sys.proc_file.obj_stub)))

       (block recv_and_send_invalid_packets

              ;;
              ;; Contexts
              ;;

              (genfscon "selinuxfs"
                        "/booleans/sys.recv_and_send_invalid_packets"
                        bool_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sec.bool_file.obj_template)

              (booleanif recv_and_send_invalid_packets
                         (true
                          (allow recv_invalid_packets_subj_type_attribute
                                 invalid.isid (packet (recv)))
                          (allow send_invalid_packets_subj_type_attribute
                                 invalid.isid (packet (send))))))

       (block recv_invalid_peers

              ;;
              ;; Contexts
              ;;

              (genfscon "selinuxfs" "/booleans/sys.recv_invalid_peers"
                        bool_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sec.bool_file.obj_template)

              (booleanif recv_invalid_peers
                         (true
                          (allow recv_invalid_peers_subj_type_attribute
                                 invalid.isid (peer (recv))))))

       (block security_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/fs/protected_hardlinks"
                        sysctl_file_context)
              (genfscon "proc" "/sys/fs/protected_symlinks"
                        sysctl_file_context)
              (genfscon "proc" "/sys/fs/suid_dumpable" sysctl_file_context)
              (genfscon "proc" "/sys/kernel/dmesg_restrict"
                        sysctl_file_context)
              (genfscon "proc" "/sys/kernel/kptr_restrict" sysctl_file_context)
              (genfscon "proc" "/sys/kernel/modules_disabled"
                        sysctl_file_context)
              (genfscon "proc" "/sys/kernel/randomize_va_space"
                        sysctl_file_context)
              (genfscon "proc" "/sys/kernel/yama" sysctl_file_context)
              (genfscon "proc" "/sys/vm/mmap_min_addr" sysctl_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 sysctl_file append_file_perms)
                     (call search (ARG1))
                     (call write_security_subj_type (ARG1)))

              (macro getattr ((type ARG1))
                     (call getattr_dirs (ARG1))
                     (call getattr_files (ARG1))
                     (call getattr_lnk_files (ARG1)))

              (macro getattr_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (getattr)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (getattr)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro getattr_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (getattr)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro list ((type ARG1))
                     (allow ARG1 sysctl_file list_dir_perms)
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro read ((type ARG1))
                     (call list (ARG1))
                     (call read_files (ARG1))
                     (call read_lnk_files (ARG1)))

              (macro read_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (read)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro read_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (read)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabel ((type ARG1))
                     (call relabel_dirs (ARG1))
                     (call relabel_files (ARG1))
                     (call relabel_lnk_files (ARG1)))

              (macro relabel_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabel)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabel)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabel_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabel)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabelfrom ((type ARG1))
                     (call relabelfrom_dirs (ARG1))
                     (call relabelfrom_files (ARG1))
                     (call relabelfrom_lnk_files (ARG1)))

              (macro relabelfrom_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabelfrom)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabelfrom)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabelfrom_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabelfrom)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabelto ((type ARG1))
                     (call relabelto_dirs (ARG1))
                     (call relabelto_files (ARG1))
                     (call relabelto_lnk_files (ARG1)))

              (macro relabelto_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabelto)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabelto)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro relabelto_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabelto)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro rw ((type ARG1))
                     (call rw_dirs (ARG1))
                     (call rw_files (ARG1))
                     (call rw_lnk_files (ARG1)))

              (macro rw_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (rw)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro rw_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (rw)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1))
                     (call write_security_subj_type (ARG1)))

              (macro rw_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (rw)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro search ((type ARG1))
                     (allow ARG1 sysctl_file search_dir_perms)
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro setattr ((type ARG1))
                     (call setattr_dirs (ARG1))
                     (call setattr_files (ARG1))
                     (call setattr_lnk_files (ARG1)))

              (macro setattr_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (setattr)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (setattr)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro setattr_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (setattr)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro write ((type ARG1))
                     (call write_dirs (ARG1))
                     (call write_files (ARG1))
                     (call write_lnk_files (ARG1)))

              (macro write_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (write)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              (macro write_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (write)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1))
                     (call write_security_subj_type (ARG1)))

              (macro write_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (write)))
                     (call fs_sysctl.search (ARG1))
                     (call kernel_sysctl.search (ARG1))
                     (call vm_sysctl.search (ARG1)))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_stub)

              (neverallow
               not_unconfined_subj_type_or_write_security_subj_type_attribute
               sysctl_file (file (append write))))

       (block sysctl_file

              ;;
              ;; Macros
              ;;

              (macro dontaudit_write_files ((type ARG1))
                     (dontaudit ARG1 obj_type_attribute write_file_perms))

              (blockinherit obj_all_macro_template)

              ;;
              ;; Policy
              ;;

              (typeattribute obj_type_attribute)

              (call sys.obj_type (obj_type_attribute))

              (allow unconfined_subj_type_attribute obj_type_attribute
                     list_dir_perms)
              (allow unconfined_subj_type_attribute obj_type_attribute
                     read_lnk_file_perms)
              (allow unconfined_subj_type_attribute obj_type_attribute
                     rw_file_perms)

              (allow unconfined_subj_type_attribute isid
                     (dir (getattr mounton)))

              ;;
              ;; Templates
              ;;

              (block obj_all_macro_template

                     ;;
                     ;; Macros
                     ;;

                     (macro dontaudit_read ((type ARG1))
                            (dontaudit ARG1 obj_type_attribute list_dir_perms)
                            (dontaudit ARG1 obj_type_attribute read_file_perms)
                            (dontaudit ARG1 obj_type_attribute
                                       read_lnk_file_perms))

                     (macro append_files ((type ARG1))
                            (allow ARG1 obj_type_attribute append_file_perms)
                            (call search (ARG1))
                            (call sys.write_security_subj_type (ARG1))
                            (call sys.write_usermodehelper_subj_type (ARG1)))

                     (macro getattr ((type ARG1))
                            (call getattr_dirs (ARG1))
                            (call getattr_files (ARG1))
                            (call getattr_lnk_files (ARG1)))

                     (macro getattr_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dir (getattr)))
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro getattr_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (file (getattr)))
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro getattr_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (lnk_file
                                                            (getattr)))
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro list ((type ARG1))
                            (allow ARG1 obj_type_attribute list_dir_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro obj_type ((type ARG1))
                            (typeattributeset obj_type_attribute ARG1))

                     (macro read ((type ARG1))
                            (call list (ARG1))
                            (call read_files (ARG1))
                            (call read_lnk_files (ARG1)))

                     (macro read_files ((type ARG1))
                            (allow ARG1 obj_type_attribute read_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro read_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute read_lnk_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabel ((type ARG1))
                            (call relabel_dirs (ARG1))
                            (call relabel_files (ARG1))
                            (call relabel_lnk_files (ARG1)))

                     (macro relabel_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute relabel_dir_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabel_files ((type ARG1))
                            (allow ARG1 obj_type_attribute relabel_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabel_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabel_lnk_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabelfrom ((type ARG1))
                            (call relabelfrom_dirs (ARG1))
                            (call relabelfrom_files (ARG1))
                            (call relabelfrom_lnk_files (ARG1)))

                     (macro relabelfrom_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_dir_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabelfrom_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabelfrom_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_lnk_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabelto ((type ARG1))
                            (call relabelto_dirs (ARG1))
                            (call relabelto_files (ARG1))
                            (call relabelto_lnk_files (ARG1)))

                     (macro relabelto_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute relabelto_dir_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabelto_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelto_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro relabelto_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelto_lnk_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro rw ((type ARG1))
                            (call rw_dirs (ARG1))
                            (call rw_files (ARG1))
                            (call rw_lnk_files (ARG1)))

                     (macro rw_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_dir_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro rw_files ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_file_perms)
                            (call sys.generic_sysctl.search (ARG1))
                            (call sys.write_security_subj_type (ARG1))
                            (call sys.write_usermodehelper_subj_type (ARG1)))

                     (macro rw_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_lnk_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro search ((type ARG1))
                            (allow ARG1 obj_type_attribute search_dir_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro setattr ((type ARG1))
                            (call setattr_dirs (ARG1))
                            (call setattr_files (ARG1))
                            (call setattr_lnk_files (ARG1)))

                     (macro setattr_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dir (setattr)))
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro setattr_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (file (setattr)))
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro setattr_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (lnk_file
                                                            (setattr)))
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro write ((type ARG1))
                            (call write_dirs (ARG1))
                            (call write_files (ARG1))
                            (call write_lnk_files (ARG1)))

                     (macro write_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute write_dir_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     (macro write_files ((type ARG1))
                            (allow ARG1 obj_type_attribute write_file_perms)
                            (call sys.generic_sysctl.search (ARG1))
                            (call sys.write_security_subj_type (ARG1))
                            (call sys.write_usermodehelper_subj_type (ARG1)))

                     (macro write_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   write_lnk_file_perms)
                            (call sys.generic_sysctl.search (ARG1)))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_all_macro_template))

              (block obj_stub

                     ;;
                     ;; Contexts
                     ;;

                     (context sysctl_file_context (sys.id
                                                   sys.role sysctl_file
                                                   (systemlow systemlow)))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_stub)

                     (type sysctl_file)
                     (call sys.sysctl_file.obj_type (sysctl_file)))

              (block obj_template

                     ;;
                     ;; Macros
                     ;;

                     (macro append_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (append)))
                            (call generic_sysctl.search (ARG1)))

                     (macro getattr ((type ARG1))
                            (call getattr_dirs (ARG1))
                            (call getattr_files (ARG1))
                            (call getattr_lnk_files (ARG1)))

                     (macro getattr_dirs ((type ARG1))
                            (allow ARG1 sysctl_file (dirs (getattr)))
                            (call generic_sysctl.search (ARG1)))

                     (macro getattr_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (getattr)))
                            (call generic_sysctl.search (ARG1)))

                     (macro getattr_lnk_files ((type ARG1))
                            (allow ARG1 sysctl_file (lnk_files (getattr)))
                            (call generic_sysctl.search (ARG1)))

                     (macro list ((type ARG1))
                            (allow ARG1 sysctl_file list_dir_perms)
                            (call generic_sysctl.search (ARG1)))

                     (macro read ((type ARG1))
                            (call list (ARG1))
                            (call read_files (ARG1))
                            (call read_lnk_files (ARG1)))

                     (macro read_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (read)))
                            (call generic_sysctl.search (ARG1)))

                     (macro read_lnk_files ((type ARG1))
                            (allow ARG1 sysctl_file (lnk_files (read)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabel ((type ARG1))
                            (call relabel_dirs (ARG1))
                            (call relabel_files (ARG1))
                            (call relabel_lnk_files (ARG1)))

                     (macro relabel_dirs ((type ARG1))
                            (allow ARG1 sysctl_file (dirs (relabel)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabel_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (relabel)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabel_lnk_files ((type ARG1))
                            (allow ARG1 sysctl_file (lnk_files (relabel)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabelfrom ((type ARG1))
                            (call relabelfrom_dirs (ARG1))
                            (call relabelfrom_files (ARG1))
                            (call relabelfrom_lnk_files (ARG1)))

                     (macro relabelfrom_dirs ((type ARG1))
                            (allow ARG1 sysctl_file (dirs (relabelfrom)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabelfrom_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (relabelfrom)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabelfrom_lnk_files ((type ARG1))
                            (allow ARG1 sysctl_file (lnk_files (relabelfrom)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabelto ((type ARG1))
                            (call relabelto_dirs (ARG1))
                            (call relabelto_files (ARG1))
                            (call relabelto_lnk_files (ARG1)))

                     (macro relabelto_dirs ((type ARG1))
                            (allow ARG1 sysctl_file (dirs (relabelto)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabelto_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (relabelto)))
                            (call generic_sysctl.search (ARG1)))

                     (macro relabelto_lnk_files ((type ARG1))
                            (allow ARG1 sysctl_file (lnk_files (relabelto)))
                            (call generic_sysctl.search (ARG1)))

                     (macro rw ((type ARG1))
                            (call rw_dirs (ARG1))
                            (call rw_files (ARG1))
                            (call rw_lnk_files (ARG1)))

                     (macro rw_dirs ((type ARG1))
                            (allow ARG1 sysctl_file rw_dir_perms)
                            (call generic_sysctl.search (ARG1)))

                     (macro rw_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (rw)))
                            (call generic_sysctl.search (ARG1)))

                     (macro rw_lnk_files ((type ARG1))
                            (allow ARG1 sysctl_file (lnk_files (rw)))
                            (call generic_sysctl.search (ARG1)))

                     (macro search ((type ARG1))
                            (allow ARG1 sysctl_file search_dir_perms)
                            (call generic_sysctl.search (ARG1)))

                     (macro setattr ((type ARG1))
                            (call setattr_dirs (ARG1))
                            (call setattr_files (ARG1))
                            (call setattr_lnk_files (ARG1)))

                     (macro setattr_dirs ((type ARG1))
                            (allow ARG1 sysctl_file (dirs (setattr)))
                            (call generic_sysctl.search (ARG1)))

                     (macro setattr_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (setattr)))
                            (call generic_sysctl.search (ARG1)))

                     (macro setattr_lnk_files ((type ARG1))
                            (allow ARG1 sysctl_file (lnk_files (setattr)))
                            (call generic_sysctl.search (ARG1)))

                     (macro write ((type ARG1))
                            (call write_dirs (ARG1))
                            (call write_files (ARG1))
                            (call write_lnk_files (ARG1)))

                     (macro write_dirs ((type ARG1))
                            (allow ARG1 sysctl_file (dirs (write)))
                            (call generic_sysctl.search (ARG1)))

                     (macro write_files ((type ARG1))
                            (allow ARG1 sysctl_file (files (write)))
                            (call generic_sysctl.search (ARG1)))

                     (macro write_lnk_files ((type ARG1))
                            (allow ARG1 sysctl_file (lnk_files (write)))
                            (call generic_sysctl.search (ARG1)))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_template)

                     (blockinherit sys.sysctl_file.obj_stub)))

       (block sysfs_file

              ;;
              ;; Macros
              ;;

              (blockinherit obj_all_macro_template)

              ;;
              ;; Policy
              ;;

              (typeattribute obj_type_attribute)

              (call sys.obj_type (obj_type_attribute))

              (allow unconfined_subj_type_attribute obj_type_attribute
                     list_dir_perms)
              (allow unconfined_subj_type_attribute obj_type_attribute
                     read_lnk_file_perms)
              (allow unconfined_subj_type_attribute obj_type_attribute
                     rw_file_perms)

              ;;
              ;; Templates
              ;;

              (block obj_all_macro_template

                     ;;
                     ;; Macros
                     ;;

                     (macro dontaudit_read ((type ARG1))
                            (dontaudit ARG1 obj_type_attribute list_dir_perms)
                            (dontaudit ARG1 obj_type_attribute read_file_perms)
                            (dontaudit ARG1 obj_type_attribute
                                       read_lnk_file_perms))

                     (macro append_files ((type ARG1))
                            (allow ARG1 obj_type_attribute append_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro getattr ((type ARG1))
                            (call getattr_dirs (ARG1))
                            (call getattr_files (ARG1))
                            (call getattr_lnk_files (ARG1)))

                     (macro getattr_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dir (getattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro getattr_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (file (getattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro getattr_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (lnk_file
                                                            (getattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro list ((type ARG1))
                            (allow ARG1 obj_type_attribute list_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro obj_type ((type ARG1))
                            (typeattributeset obj_type_attribute ARG1))

                     (macro read ((type ARG1))
                            (call list (ARG1))
                            (call read_files (ARG1))
                            (call read_lnk_files (ARG1)))

                     (macro read_files ((type ARG1))
                            (allow ARG1 obj_type_attribute read_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro read_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute read_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabel ((type ARG1))
                            (call relabel_dirs (ARG1))
                            (call relabel_files (ARG1))
                            (call relabel_lnk_files (ARG1)))

                     (macro relabel_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute relabel_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabel_files ((type ARG1))
                            (allow ARG1 obj_type_attribute relabel_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabel_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabel_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelfrom ((type ARG1))
                            (call relabelfrom_dirs (ARG1))
                            (call relabelfrom_files (ARG1))
                            (call relabelfrom_lnk_files (ARG1)))

                     (macro relabelfrom_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelfrom_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelfrom_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelfrom_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelto ((type ARG1))
                            (call relabelto_dirs (ARG1))
                            (call relabelto_files (ARG1))
                            (call relabelto_lnk_files (ARG1)))

                     (macro relabelto_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute relabelto_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelto_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelto_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelto_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   relabelto_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro rw ((type ARG1))
                            (call rw_dirs (ARG1))
                            (call rw_files (ARG1))
                            (call rw_lnk_files (ARG1)))

                     (macro rw_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro rw_files ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro rw_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute rw_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro search ((type ARG1))
                            (allow ARG1 obj_type_attribute search_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro setattr ((type ARG1))
                            (call setattr_dirs (ARG1))
                            (call setattr_files (ARG1))
                            (call setattr_lnk_files (ARG1)))

                     (macro setattr_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute (dir (setattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro setattr_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (file (setattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro setattr_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute (lnk_file
                                                            (setattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro write ((type ARG1))
                            (call write_dirs (ARG1))
                            (call write_files (ARG1))
                            (call write_lnk_files (ARG1)))

                     (macro write_dirs ((type ARG1))
                            (allow ARG1 obj_type_attribute write_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro write_files ((type ARG1))
                            (allow ARG1 obj_type_attribute write_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro write_lnk_files ((type ARG1))
                            (allow ARG1 obj_type_attribute
                                   write_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_all_macro_template))

              (block obj_stub

                     ;;
                     ;; Contexts
                     ;;

                     (context sysfs_file_context
                              (sys.id sys.role sysfs_file (systemlow
                                                           systemlow)))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_stub)

                     (type sysfs_file)
                     (call sys.sysfs_file.obj_type (sysfs_file)))

              (block obj_template

                     ;;
                     ;; Macros
                     ;;

                     (macro append_files ((type ARG1))
                            (allow ARG1 sysfs_file append_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro getattr ((type ARG1))
                            (call getattr_dirs (ARG1))
                            (call getattr_files (ARG1))
                            (call getattr_lnk_files (ARG1)))

                     (macro getattr_dirs ((type ARG1))
                            (allow ARG1 sysfs_file (dir (getattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro getattr_files ((type ARG1))
                            (allow ARG1 sysfs_file (file (getattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro getattr_lnk_files ((type ARG1))
                            (allow ARG1 sysfs_file (lnk_file (getattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro list ((type ARG1))
                            (allow ARG1 sysfs_file list_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro read ((type ARG1))
                            (call list (ARG1))
                            (call read_files (ARG1))
                            (call read_lnk_files (ARG1)))

                     (macro read_files ((type ARG1))
                            (allow ARG1 sysfs_file read_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro read_lnk_files ((type ARG1))
                            (allow ARG1 sysfs_file read_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabel ((type ARG1))
                            (call relabel_dirs (ARG1))
                            (call relabel_files (ARG1))
                            (call relabel_lnk_files (ARG1)))

                     (macro relabel_dirs ((type ARG1))
                            (allow ARG1 sysfs_file relabel_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabel_files ((type ARG1))
                            (allow ARG1 sysfs_file relabel_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabel_lnk_files ((type ARG1))
                            (allow ARG1 sysfs_file relabel_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelfrom ((type ARG1))
                            (call relabelfrom_dirs (ARG1))
                            (call relabelfrom_files (ARG1))
                            (call relabelfrom_lnk_files (ARG1)))

                     (macro relabelfrom_dirs ((type ARG1))
                            (allow ARG1 sysfs_file relabelfrom_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelfrom_files ((type ARG1))
                            (allow ARG1 sysfs_file relabelfrom_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelfrom_lnk_files ((type ARG1))
                            (allow ARG1 sysfs_file relabelfrom_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelto ((type ARG1))
                            (call relabelto_dirs (ARG1))
                            (call relabelto_files (ARG1))
                            (call relabelto_lnk_files (ARG1)))

                     (macro relabelto_dirs ((type ARG1))
                            (allow ARG1 sysfs_file relabelto_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelto_files ((type ARG1))
                            (allow ARG1 sysfs_file relabelto_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro relabelto_lnk_files ((type ARG1))
                            (allow ARG1 sysfs_file relabelto_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro rw ((type ARG1))
                            (call rw_dirs (ARG1))
                            (call rw_files (ARG1))
                            (call rw_lnk_files (ARG1)))

                     (macro rw_dirs ((type ARG1))
                            (allow ARG1 sysfs_file rw_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro rw_files ((type ARG1))
                            (allow ARG1 sysfs_file rw_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro rw_lnk_files ((type ARG1))
                            (allow ARG1 sysfs_file rw_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro search ((type ARG1))
                            (allow ARG1 sysfs_file search_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro setattr ((type ARG1))
                            (call setattr_dirs (ARG1))
                            (call setattr_files (ARG1))
                            (call setattr_lnk_files (ARG1)))

                     (macro setattr_dirs ((type ARG1))
                            (allow ARG1 sysfs_file (dir (setattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro setattr_files ((type ARG1))
                            (allow ARG1 sysfs_file (file (setattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro setattr_lnk_files ((type ARG1))
                            (allow ARG1 sysfs_file (lnk_file (setattr)))
                            (call fs.sysfs.search (ARG1)))

                     (macro write ((type ARG1))
                            (call write_dirs (ARG1))
                            (call write_files (ARG1))
                            (call write_lnk_files (ARG1)))

                     (macro write_dirs ((type ARG1))
                            (allow ARG1 sysfs_file write_dir_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro write_files ((type ARG1))
                            (allow ARG1 sysfs_file write_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     (macro write_lnk_files ((type ARG1))
                            (allow ARG1 sysfs_file write_lnk_file_perms)
                            (call fs.sysfs.search (ARG1)))

                     ;;
                     ;; Policy
                     ;;

                     (blockabstract obj_template)

                     (blockinherit sys.sysfs_file.obj_stub)))

       (block sysrq_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sysrq-trigger" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro mounton_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr mounton))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub)

              (allow unconfined_subj_type_attribute proc_file
                     (file (getattr mounton))))

       (block timer_proc

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/timer_list" proc_file_context)
              (genfscon "proc" "/timer_stats" proc_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 proc_file append_file_perms))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr))))

              (macro mounton_files ((type ARG1))
                     (allow ARG1 proc_file (file (getattr mounton))))

              (macro read_files ((type ARG1))
                     (allow ARG1 proc_file read_file_perms))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 proc_file relabel_file_perms))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 proc_file relabelfrom_file_perms))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 proc_file relabelto_file_perms))

              (macro rw_files ((type ARG1))
                     (allow ARG1 proc_file rw_file_perms))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 proc_file (file (setattr))))

              (macro write_files ((type ARG1))
                     (allow ARG1 proc_file write_file_perms))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.proc_file.obj_stub)

              (allow unconfined_subj_type_attribute proc_file
                     (file (getattr mounton))))

       (block unlabeled

              ;;
              ;; Contexts
              ;;

              (sidcontext file isid_context)

              ;;
              ;; Macros
              ;;

              (blockinherit invalid.obj_all_macro_template)

              (macro dontaudit_audit_access_dirs ((type ARG1))
                     (dontaudit ARG1 isid (dir (audit_access))))

              (macro dontaudit_setattr_dirs ((type ARG1))
                     (dontaudit ARG1 isid (dir (setattr))))

              (macro mounton_dirs ((type ARG1))
                     (allow ARG1 isid (dir (getattr mounton))))

              ;;
              ;; Policy
              ;;

              (blockinherit isid.stub)

              (roletype role isid)

              (allow isid self (filesystem (associate)))

              (call fs.xattr.associate (isid))

              (allow unconfined_subj_type_attribute isid
                     blk_file_except_execmod_map_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     chr_file_except_execmod_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     dir_except_execmod_and_map)
              (allow unconfined_subj_type_attribute isid
                     fifo_file_except_execmod_map_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     file_except_entrypoint_execmod_and_mounton)
              (allow unconfined_subj_type_attribute isid
                     (filesystem (associate getattr mount quotaget quotamod
                                            remount relabelfrom relabelto
                                            unmount)))
              (allow unconfined_subj_type_attribute isid
                     lnk_file_except_execmod_map_and_mounton)
              (allow unconfined_subj_type_attribute isid signal_perms)
              (allow unconfined_subj_type_attribute isid
                     sock_file_except_execmod_map_and_mounton))

       (block user_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/user" sysctl_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template))

       (block usermodehelper_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/kernel/core_pattern" sysctl_file_context)
              (genfscon "proc" "/sys/kernel/modprobe" sysctl_file_context)
              (genfscon "proc" "/sys/kernel/poweroff_cmd" sysctl_file_context)
              (genfscon "proc" "/sys/kernel/usermodehelper"
                        sysctl_file_context)

              ;;
              ;; Macros
              ;;

              (macro dontaudit_write_files ((type ARG1))
                     (dontaudit ARG1 sysctl_file write_file_perms))

              (macro append_files ((type ARG1))
                     (allow ARG1 sysctl_file append_file_perms)
                     (call search (ARG1))
                     (call write_usermodehelper_subj_type (ARG1)))

              (macro getattr ((type ARG1))
                     (call getattr_dirs (ARG1))
                     (call getattr_files (ARG1))
                     (call getattr_lnk_files (ARG1)))

              (macro getattr_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (getattr)))
                     (call kernel_sysctl.search (ARG1)))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (getattr)))
                     (call kernel_sysctl.search (ARG1)))

              (macro getattr_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (getattr)))
                     (call kernel_sysctl.search (ARG1)))

              (macro list ((type ARG1))
                     (allow ARG1 sysctl_file list_dir_perms)
                     (call kernel_sysctl.search (ARG1)))

              (macro read ((type ARG1))
                     (call list (ARG1))
                     (call read_files (ARG1))
                     (call read_lnk_files (ARG1)))

              (macro read_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (read)))
                     (call kernel_sysctl.search (ARG1)))

              (macro read_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (read)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabel ((type ARG1))
                     (call relabel_dirs (ARG1))
                     (call relabel_files (ARG1))
                     (call relabel_lnk_files (ARG1)))

              (macro relabel_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabel)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabel)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabel_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabel)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabelfrom ((type ARG1))
                     (call relabelfrom_dirs (ARG1))
                     (call relabelfrom_files (ARG1))
                     (call relabelfrom_lnk_files (ARG1)))

              (macro relabelfrom_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabelfrom)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabelfrom)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabelfrom_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabelfrom)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabelto ((type ARG1))
                     (call relabelto_dirs (ARG1))
                     (call relabelto_files (ARG1))
                     (call relabelto_lnk_files (ARG1)))

              (macro relabelto_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (relabelto)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (relabelto)))
                     (call kernel_sysctl.search (ARG1)))

              (macro relabelto_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (relabelto)))
                     (call kernel_sysctl.search (ARG1)))

              (macro rw ((type ARG1))
                     (call rw_dirs (ARG1))
                     (call rw_files (ARG1))
                     (call rw_lnk_files (ARG1)))

              (macro rw_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (rw)))
                     (call kernel_sysctl.search (ARG1)))

              (macro rw_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (rw)))
                     (call kernel_sysctl.search (ARG1))
                     (call write_usermodehelper_subj_type (ARG1)))

              (macro rw_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (rw)))
                     (call kernel_sysctl.search (ARG1)))

              (macro search ((type ARG1))
                     (allow ARG1 sysctl_file search_dir_perms)
                     (call kernel_sysctl.search (ARG1)))

              (macro setattr ((type ARG1))
                     (call setattr_dirs (ARG1))
                     (call setattr_files (ARG1))
                     (call setattr_lnk_files (ARG1)))

              (macro setattr_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (setattr)))
                     (call kernel_sysctl.search (ARG1)))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (setattr)))
                     (call kernel_sysctl.search (ARG1)))

              (macro setattr_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (setattr)))
                     (call kernel_sysctl.search (ARG1)))

              (macro write ((type ARG1))
                     (call write_dirs (ARG1))
                     (call write_files (ARG1))
                     (call write_lnk_files (ARG1)))

              (macro write_dirs ((type ARG1))
                     (allow ARG1 sysctl_file (dirs (write)))
                     (call kernel_sysctl.search (ARG1)))

              (macro write_files ((type ARG1))
                     (allow ARG1 sysctl_file (files (write)))
                     (call kernel_sysctl.search (ARG1))
                     (call write_usermodehelper_subj_type (ARG1)))

              (macro write_lnk_files ((type ARG1))
                     (allow ARG1 sysctl_file (lnk_files (write)))
                     (call kernel_sysctl.search (ARG1)))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_stub)

              (neverallow
               not_unconfined_subj_type_or_write_usermodehelper_subj_type_attribute
               sysctl_file (file (append write))))

       (block var_log

              ;;
              ;; Contexts
              ;;

              (filecon "/var/log/boot\.log.*" file var_log_file_context)

              ;;
              ;; Macros
              ;;

              (macro generic_var_log_obj_type_transition ((type ARG1))
                     (call files.generic_var_log.obj_type_transition
                           (ARG1 var_log_file file "boot.log")))

              ;;
              ;; Policy
              ;;

              (blockinherit files.var_log_file.obj_template)

              (call manage_files (sys.isid))

              (call generic_var_log_obj_type_transition (sys.isid)))

       (block vm_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/vm" sysctl_file_context)

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_template))

       (block vm_overcommit_sysctl

              ;;
              ;; Contexts
              ;;

              (genfscon "proc" "/sys/vm/overcommit_memory" sysctl_file_context)

              ;;
              ;; Macros
              ;;

              (macro append_files ((type ARG1))
                     (allow ARG1 sysctl_file append_file_perms)
                     (call vm_sysctl.search (ARG1)))

              (macro getattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (file (getattr)))
                     (call vm_sysctl.search (ARG1)))

              (macro read_files ((type ARG1))
                     (allow ARG1 sysctl_file read_file_perms)
                     (call vm_sysctl.search (ARG1)))

              (macro relabel_files ((type ARG1))
                     (allow ARG1 sysctl_file relabel_file_perms)
                     (call vm_sysctl.search (ARG1)))

              (macro relabelfrom_files ((type ARG1))
                     (allow ARG1 sysctl_file relabelfrom_file_perms)
                     (call vm_sysctl.search (ARG1)))

              (macro relabelto_files ((type ARG1))
                     (allow ARG1 sysctl_file relabelto_file_perms)
                     (call vm_sysctl.search (ARG1)))

              (macro rw_files ((type ARG1))
                     (allow ARG1 sysctl_file rw_file_perms)
                     (call vm_sysctl.search (ARG1)))

              (macro setattr_files ((type ARG1))
                     (allow ARG1 sysctl_file (file (setattr)))
                     (call vm_sysctl.search (ARG1)))

              (macro write_files ((type ARG1))
                     (allow ARG1 sysctl_file write_file_perms)
                     (call vm_sysctl.search (ARG1)))

              ;;
              ;; Policy
              ;;

              (blockinherit sys.sysctl_file.obj_stub)))
